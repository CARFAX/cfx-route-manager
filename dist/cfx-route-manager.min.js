angular.module("cfx.routeManager",["ngRoute"]),angular.module("cfx.routeManager").provider("RouteManager",["$routeProvider","$locationProvider","$windowProvider",function(t,e,r){var n=this,a="",o="",i=!1,u={},h=r.$get(),s=function(t,e){if(!e||"/"==t)return t;for(var r in e)e.hasOwnProperty(r)&&(t=t.replace(new RegExp(":"+r+"([\\?]*)","gi"),e[r]));return t=t.replace(/(:)[^\/]*(\?)(\/*)/g,""),t=t.replace(/(\/+)$/,"")},p=function(t,e){var r=t.replace(/^(\/+)/,"").replace(/(\/+)$/,"");return e=e.replace(/^(\/+)/,""),(r?"/":"")+r+"/"+e},l=function(t){var e=a.split("/"),r=t.split("/");return e=r.slice(0,e.length),e.join("/")},c=function(t,e){var r=Object.keys(e);console.error("Route '%s' not found",t),console.info("Available routes: %o",r)};this.setBase=function(t){return"string"==typeof t&&(t={path:t}),t.path&&(a=t.path),t.templateUrl&&(o=t.templateUrl),this},this.addRoute=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&"name"!=r&&"path"!=r&&(e[r]=t[r]);return u[t.name]=t,this.when(t.path,e),this},this.when=function(e,r){return e=this.appendToBase(e),"string"==typeof r.templateUrl&&(r.templateUrl=p(o,r.templateUrl)),t.when(e,r),this},this.otherwise=function(r){var n=u[r],o=function(t,r){if(e.html5Mode())return l(r)+s(n.path,t);var o=h.location.pathname,i=o.split("/"),u=l(o),p=a.split("/").length,c=i.slice(p).join("/");return c?void(h.location.href=u+"#/"+c):s(n.path,t)};return n?t.otherwise({redirectTo:o}):c(r,u),o},this.appendToBase=function(t){return e.html5Mode()?p(a,t):t},this.$get=function(t,e){return{routes:u,formatBasePath:function(){if(i)return a;var t=s(a,e);return i=!0,a=t},path:function(e){return this.formatBasePath(),e?(e=n.appendToBase(e),t.path(e)):e=(t.path()||"").replace(a,""),e},currentRoute:function(){var t=this.path();for(var e in this.routes)if(this.routes.hasOwnProperty(e)){var r=this.routes[e];if(t==r.path)return r}return null},routeTo:function(t,e){this.formatBasePath();var r=this.routes[t];if(r){var n=s(r.path,e);return this.path(n)}return c(t,this.routes),this.path()}}}}]);